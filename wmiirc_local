#!/usr/bin/env dash
export WMII_FONT='xft:Sans-8'
MODKEY=Mod4
xrandr --output VGA-0 --left-of DVI-0
xrandr --output VGA-0 --auto
xrandr --output VGA-0 --left-of DVI-0

# tagrules
wmiir write /tagrules <<!
/trayer|panel|VLC.*|MPlayer.*/ -> +/^/+~
/terminal|Firefox|nautilus/ -> sel
/main.py/ -> ~
/Thunderbird|empathy/ -> communication
/rhythmbox/ -> music
!

# Status Bar Info
battery_status() {
t=$(acpi -b|sed -n 's/.*\([0-9][0-9]:[0-9][0-9]\):[0-9][0-9].*/\1/p')
c=$(acpi -a|grep 'on'|wc -l |sed -s 's/1/⚡/' |sed -s 's/0/☢/' )
echo -n $t$c
}

updates_status() {
c=$(cut -d ';' -f1 /tmp/updates)
n=$(cut -d ';' -f2 /tmp/updates)
bar=''
if [ $c -gt 0 ]
then
 echo -n $c'⚠'
 bar='|'
fi
if [ $n -gt 0 ]
then
 echo -n $n'⚚'
 bar='|'
fi
echo -n $bar
}

status() {
echo -n \
$(iwconfig eth1 | grep 'ESSID'|cut -d':' -f2|sed -s 's/"//g')'|'\
$(battery_status)'|'\
$(updates_status)\
$(uptime | sed 's/.*: //; s/,//g; s/ /,/g')'|'\
$(date '+%a %x %X %z')
}

local_events() {
	cat << EOF
Key $MODKEY-n
	nautilus --no-desktop&

KeyGroup Multimedia
Key XF86AudioLowerVolume
	vol down
Key XF86AudioRaiseVolume
	vol up
Key XF86AudioMute
	vol mute

KeyGroup Resize Windows
Key $MODKEY-Control-$UP
	echo -n "grow sel sel down -1" | wmiir write /tag/sel/ctl
Key $MODKEY-Control-$RIGHT
	echo -n "grow sel sel right 1" | wmiir write /tag/sel/ctl
Key $MODKEY-Control-$DOWN
	echo -n "grow sel sel down 1" | wmiir write /tag/sel/ctl
Key $MODKEY-Control-$LEFT
	echo -n "grow sel sel right -1" | wmiir write /tag/sel/ctl
EOF
}

# load at startup
pgrep gnome-settings- || gnome-settings-daemon &
pgrep trayer || trayer --width 4 --edge top --height 16 --transparent true --alpha 128 &
pgrep hamster-service || hamster-time-tracker&
pgrep hamster-indicat || hamster-indicator&
pgrep pomodoro-indica || pomodoro-indicator&
pgrep gnome-fallback- || /usr/lib/gnome-settings-daemon/gnome-fallback-mount-helper&
pgrep nm-applet || nm-applet&
pgrep gnome-sound-app || gnome-sound-applet&

eval $(gnome-keyring-daemon --start)

dconf write /org/gnome/settings-daemon/plugins/xrandr/active true
dconf write /org/gnome/settings-daemon/plugins/xrandr/active false
